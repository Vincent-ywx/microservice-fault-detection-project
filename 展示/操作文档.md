



## sock-shopå¾®æœåŠ¡éƒ¨ç½²

**å‘½ä»¤è¡Œè¿›å…¥D:\microservice-fault-detection-project\demo\microservices-demo>æ–‡ä»¶ç›®å½•**

```
cd D:\microservice-fault-detection-project\demo\microservices-demo
```



- æŸ¥çœ‹çŠ¶æ€

```Bash
minikube status
```

- å¯åŠ¨å¾®æœåŠ¡sock-shop

```
minikube start --driver=docker
```

- æŸ¥çœ‹è¯¥é¡¹ç›®çš„æ‰€æœ‰å¾®æœåŠ¡ï¼ˆå…·ä½“ç»“æ„æŸ¥çœ‹sock-shopæ–‡æ¡£ï¼‰

```kubectl get svc -n sock-shopBash
kubectl get svc -n sock-shop
```

- å¯åŠ¨é›†ç¾¤ä¸­çš„pod


```
kubectl get pods -n sock-shop
```

ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç»™æ‰€æœ‰ `Deployment` åšä¸€ä¸ªæ»šåŠ¨é‡å¯ï¼š

```
kubectl rollout restart deployment -n sock-shop
```

æ•ˆæœå¦‚å›¾ï¼š

![image-20250603211245875](C:\Users\adminer\AppData\Roaming\Typora\typora-user-images\image-20250603211245875.png)

## ğŸ§© SockShop å„ Pod è§£é‡Šï¼ˆExplanation of SockShop Podsï¼‰

| Pod åç§°       | åŠŸèƒ½æè¿°ï¼ˆä¸­æ–‡ï¼‰                                  | Function Description (English)                               |
| -------------- | ------------------------------------------------- | ------------------------------------------------------------ |
| `front-end`    | ç”¨æˆ·ç•Œé¢æœåŠ¡ï¼Œæä¾› Web åº”ç”¨ç•Œé¢ï¼Œè°ƒç”¨åç«¯å…¶ä»–æœåŠ¡ | The web UI service. It serves the user-facing website and communicates with other services. |
| `carts`        | è´­ç‰©è½¦æœåŠ¡ï¼Œå¤„ç†æ·»åŠ ã€åˆ é™¤å•†å“ç­‰æ“ä½œ              | Manages the shopping cart â€” add/remove items, retrieve cart contents |
| `carts-db`     | carts æœåŠ¡ä½¿ç”¨çš„ MongoDB æ•°æ®åº“                   | MongoDB backing the carts service                            |
| `catalogue`    | å•†å“ç›®å½•æœåŠ¡ï¼Œæä¾›æ‰€æœ‰å•†å“æ•°æ®                    | Provides product listings, descriptions, prices, and stock info |
| `catalogue-db` | catalogue ä½¿ç”¨çš„ MongoDB æ•°æ®åº“                   | MongoDB for the catalogue service                            |
| `orders`       | è®¢å•æœåŠ¡ï¼Œå¤„ç†ä¸‹å•è¯·æ±‚                            | Handles order placement and processing                       |
| `orders-db`    | orders æœåŠ¡ä½¿ç”¨çš„ MySQL æ•°æ®åº“                    | MySQL used to persist orders                                 |
| `payment`      | æ”¯ä»˜æœåŠ¡ï¼Œæ¨¡æ‹Ÿæ”¯ä»˜æµç¨‹ï¼ˆæ€»æ˜¯æ”¯ä»˜æˆåŠŸï¼‰            | Simulates a payment process (always succeeds)                |
| `queue-master` | ç”¨äºå¤„ç†å¼‚æ­¥ä»»åŠ¡çš„æœåŠ¡ï¼ˆå¦‚å‘é€é‚®ä»¶ï¼‰              | Consumes tasks from RabbitMQ queue, e.g., sending confirmation emails |
| `rabbitmq`     | æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œç”¨äºæœåŠ¡é—´å¼‚æ­¥é€šä¿¡                  | Message broker used for decoupling services (mainly orders + email tasks) |
| `session-db`   | ç”¨æˆ· session å­˜å‚¨æœåŠ¡ï¼ˆRedisï¼‰                    | Redis service for storing user sessions (key-value store)    |
| `shipping`     | å‘è´§æœåŠ¡ï¼Œæ¨¡æ‹Ÿå‘è´§æ“ä½œ                            | Simulates shipping of orders                                 |
| `user`         | ç”¨æˆ·è´¦æˆ·æœåŠ¡ï¼Œå¤„ç†æ³¨å†Œã€ç™»å½•ç­‰åŠŸèƒ½                | Manages user registration and authentication                 |
| `user-db`      | user æœåŠ¡ä½¿ç”¨çš„ MySQL æ•°æ®åº“                      | MySQL database backing the user service                      |



------

## ğŸ§  å¾®æœåŠ¡è°ƒç”¨å…³ç³»ç®€å›¾ï¼ˆCall Graph Overviewï¼‰

```
sqlå¤åˆ¶ç¼–è¾‘+-------------+
|  front-end  |
+------+------+---------------+------------------+
       |                      |                  |
   [carts]                [user]            [catalogue]
       |                      |                  |
  [carts-db]            [user-db]         [catalogue-db]
       |
   [orders]---[payment]---[shipping]
       |
   [orders-db]
       |
  [queue-master] <--> [rabbitmq]
```

> `front-end` æ˜¯å”¯ä¸€ç›´æ¥é¢å‘ç”¨æˆ·çš„æœåŠ¡ï¼Œå…¶å®ƒæœåŠ¡éƒ½æ˜¯åå°æ”¯æ’‘ã€‚

------

## æ€»ç»“ï¼š

SockShop æ˜¯ä¸€ä¸ªå…¸å‹çš„ç”µå•†å¾®æœåŠ¡æ¶æ„ç¤ºä¾‹ï¼Œæ¨¡å—åˆ’åˆ†æ¸…æ™°ï¼š

- åŒ…æ‹¬ç”¨æˆ·ç®¡ç†ã€å•†å“ã€è´­ç‰©è½¦ã€è®¢å•ã€æ”¯ä»˜ã€å‘è´§ã€å¼‚æ­¥å¤„ç†ç­‰æ ¸å¿ƒç”µå•†æ¨¡å—ã€‚
- æ¯ä¸ªæœåŠ¡èŒè´£å•ä¸€ï¼Œä½¿ç”¨ç‹¬ç«‹å®¹å™¨éƒ¨ç½²ï¼Œå…·å¤‡è‰¯å¥½çš„â€œå¾®æœåŠ¡è‡ªæ²»æ€§â€ã€‚

- è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨ front-endï¼Œæ‰“å¼€æµè§ˆå™¨

```Bash
minikube service front-end -n  sock-shop
```





## chaosmeshæ³¨å…¥

- ChaosMesh æä¾›äº† Web UIï¼Œå¯ä»¥æŸ¥çœ‹å®éªŒçš„æ‰§è¡Œæƒ…å†µï¼š

```Plain
kubectl port-forward -n chaos-testing svc/chaos-dashboard 2333:2333
```

ç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—® http://localhost:2333 æŸ¥çœ‹ç»“æœã€‚

```

```

- è·å–ä»¤ç‰Œ

è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š

```
cd D:\microservice-fault-detection-project\chaosmesh\token
```

```
kubectl apply -f rbac.yaml
```

```
kubectl create token account-cluster-manager-hrgfu
```

```
account-cluster-manager-hrgfu
```





## prometheusæŸ¥çœ‹æ•°æ®

è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼ŒæŸ¥çœ‹ç›‘æ§æœåŠ¡

```Bash
kubectl get svc -n monitoring
```

è¾“å…¥ä¸‹é¢ä¸¤ä¸ªå‘½ä»¤ï¼Œåˆ†åˆ«å¾—åˆ°ä»–ä»¬çš„IPåœ°å€

```Bash
minikube service prometheus -n monitoring --url
minikube service grafana -n monitoring --url


monitoringæ— æ³•æŸ¥çœ‹ä¸ªæœåŠ¡çš„HTTP å±‚æŒ‡æ ‡
```



## monitoringæ— æ³•æŸ¥çœ‹ä¸ªæœåŠ¡çš„HTTP å±‚æŒ‡æ ‡ï¼Œé‡‡ç”¨Istio

------



## ä¸º SockShop é›†æˆ Istio + Prometheusï¼ˆæ”¯æŒ AutoMAPï¼‰

ä¸ºäº†æ”¯æŒ AutoMAP çš„è¡Œä¸ºå›¾æ„å»ºå’Œæ ¹å› å®šä½ï¼Œéœ€è¦é‡‡é›†ä»¥ä¸‹ HTTP å±‚æŒ‡æ ‡ï¼š

- è¯·æ±‚å»¶è¿Ÿï¼ˆMlatï¼‰
- ååç‡ï¼ˆMthrï¼‰
- HTTP çŠ¶æ€ç ç»Ÿè®¡ï¼ˆç”¨äº Mavlï¼‰

æœ€ç®€å•å¯é çš„æ–¹å¼æ˜¯ä½¿ç”¨ **Istio + Prometheus** å®ç°è‡ªåŠ¨é‡‡é›†ã€‚

#### ğŸ”¹ æ­¥éª¤ 1ï¼šå®‰è£… Istioï¼ˆç¤ºä¾‹ä¸º Minikube ç¯å¢ƒï¼‰

```
https://istio.io/downloadIstio | ISTIO_VERSION=1.22.0 sh -
cd istio-1.22.0
export PATH=$PWD/bin:$PATH
istioctl install --set profile=demo -y
```

#### ğŸ”¹ æ­¥éª¤ 2ï¼šå¯ç”¨è‡ªåŠ¨æ³¨å…¥ sidecar

```
kubectl label namespace sock-shop istio-injection=enabled
```

#### ğŸ”¹ æ­¥éª¤ 3ï¼šé‡æ–°éƒ¨ç½² SockShopï¼ˆç¡®ä¿æ³¨å…¥ sidecarï¼‰

```
kubectl delete -f complete-demo.yaml -n sock-shop
kubectl apply -f complete-demo.yaml -n sock-shop
```

> æ‰€æœ‰æœåŠ¡ä¼šè‡ªåŠ¨æ³¨å…¥ `istio-proxy` å®¹å™¨ï¼Œç”¨äºè½¬å‘æµé‡å¹¶é‡‡é›†è¯·æ±‚æŒ‡æ ‡ã€‚

#### ğŸ”¹ æ­¥éª¤ 4ï¼šè®¿é—® Istio è‡ªå¸¦çš„ Prometheus

Istio è‡ªå¸¦ Prometheusï¼Œå¯ç”¨äºç›´æ¥æŸ¥è¯¢ï¼š

```
kubectl port-forward svc/prometheus -n istio-system 9090:9090
```

æµè§ˆå™¨æ‰“å¼€ï¼š

[Prometheus Time Series Collection and Processing Server](http://localhost:9090/graph?g0.expr=&g0.tab=1&g0.display_mode=lines&g0.show_exemplars=0&g0.range_input=1h)

> ```
> http://localhost:9090
> ```
>



éªŒè¯æ‰€æœ‰å¾®æœåŠ¡æ˜¯å¦å·²æˆåŠŸæ³¨å…¥ sidecar

```
kubectl get pods -n sock-shop -o jsonpath="{range .items[*]}{.metadata.name}{'\t'}{range .spec.containers[*]}{.name}{','}{end}{'\n'}{end}" | sort
```



| æŒ‡æ ‡              | PromQL ç¤ºä¾‹                                                  |
| ----------------- | ------------------------------------------------------------ |
| **Mlat** å¹³å‡å»¶è¿Ÿ | `rate(istio_request_duration_milliseconds_sum[1m]) / rate(istio_request_duration_milliseconds_count[1m])` |
| **Mthr** ååç‡   | `rate(istio_requests_total[1m])`                             |
| **Mcon** å¹¶å‘æ•°   | `rate(istio_requests_total[1m]) / (rate(istio_request_duration_milliseconds_sum[1m]) / rate(istio_request_duration_milliseconds_count[1m]))` |
| **Mavl** å¯ç”¨ç‡   | `sum(rate(istio_requests_total{response_code=~"2.."}[1m])) / sum(rate(istio_requests_total[1m]))` |

![image-20250607230128311](C:\Users\adminer\AppData\Roaming\Typora\typora-user-images\image-20250607230128311.png)

### **è§¦å‘æ­£å¸¸è´Ÿè½½**

AutoMAP ä¾èµ–â€œç¨³å®šè¿è¡ŒçŠ¶æ€â€çš„è¡Œä¸ºå›¾ï¼ˆnormal graphï¼‰ï¼Œä½ éœ€è¦ç¡®ä¿ SockShop ç³»ç»Ÿå…ˆå¤„äºä¸€æ®µæ—¶é—´çš„æ­£å¸¸è¿è¡Œã€‚

## ä½¿ç”¨ Selenium/JMeter ç­‰å·¥å…·æ‰¹é‡å‘é€è¯·æ±‚ã€‚

æ‰“å¼€jmeterï¼Œæµ‹è¯•front-end

## ä½¿ç”¨ ChaosMesh front-endå¾®æœåŠ¡æ³¨å…¥å»¶è¿Ÿæˆ–æ•…éšœ

è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ ChaosMesh æ˜¯å¦å·²å°±ç»ªï¼š

```
kubectl get pods -n chaos-testing
```

## å®Œæ•´çš„ AutoMAP åŸå‹è„šæœ¬æ¡†æ¶

- æ•°æ®é‡‡é›†é˜¶æ®µ

- å›¾å»ºæ¨¡é˜¶æ®µ

- æ ¹å› å®šä½é˜¶æ®µï¼ˆç›¸ä¼¼åº¦ + å¯å‘å¼éšæœºæ¸¸èµ°ï¼‰

  

## ç”¨é€”å¦‚ä¸‹ï¼š

### â‘  **æ ¹å› å®šä½ï¼šå®šä½å‡ºæœ€å¯èƒ½å‡ºé—®é¢˜çš„å¾®æœåŠ¡**

è¾“å‡ºçš„æ’åºå¦‚ä¸‹ï¼š

```
1. paymentï¼ˆå¾—åˆ†: 0.1890ï¼‰
2. catalogueï¼ˆå¾—åˆ†: 0.1851ï¼‰
3. userï¼ˆå¾—åˆ†: 0.1724ï¼‰
...
```

è¿™è¡¨ç¤ºï¼Œåœ¨æŸä¸€æ—¶åˆ»ç³»ç»Ÿè¡¨ç°å¼‚å¸¸æ—¶ï¼Œ`payment` æœåŠ¡æœ€å¯èƒ½æ˜¯â€œæ ¹å› æ•…éšœç‚¹â€ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ ï¼š

- **åŠ å¿«æ’æŸ¥æ•…éšœé€Ÿåº¦**ï¼šæ— éœ€ä»å‡ åä¸ªæœåŠ¡ä¸­ç›²æŸ¥ï¼›
- **ä¼˜å…ˆé‡å¯æˆ–é™çº§æœ‰é—®é¢˜çš„æœåŠ¡**ï¼›
- **ä¸ ChaosMesh çš„æ³¨å…¥ç‚¹åšæ¯”å¯¹**ï¼ŒéªŒè¯è¯Šæ–­ç²¾åº¦ï¼›
- **ä½œä¸ºè¿ç»´è‡ªåŠ¨åŒ–ç­–ç•¥çš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚å‘Šè­¦è·¯ç”±ã€SLO ç›‘æ§ï¼‰**ã€‚

------

### â‘¡ **è¡Œä¸ºå›¾æ„å»ºä¸èŠ‚ç‚¹ Profile æ•°æ®**

ä½ çœ‹åˆ°çš„ `front-end profile: [...]` æ˜¯è¯¥æœåŠ¡çš„ç‰¹å¾å‘é‡ï¼Œç”±å¤šä¸ªæŒ‡æ ‡æ‹¼æ¥è€Œæˆï¼š

- åŒ…æ‹¬ **Mlatï¼ˆå»¶è¿Ÿï¼‰**ã€**Mcpuï¼ˆCPUï¼‰**ã€**Mmemï¼ˆå†…å­˜ï¼‰**ã€**Mthrï¼ˆè¯·æ±‚ååï¼‰** ç­‰å¤šç»´åº¦ï¼›
- æ˜¯è¡Œä¸ºå›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„**è¯­ä¹‰åµŒå…¥**ï¼Œç”¨äºåç»­çš„**ç›¸ä¼¼åº¦åŒ¹é…**ï¼›
- å¯ç”¨äºå¯è§†åŒ–åˆ†æï¼Œæˆ–è€…ä½œä¸ºè¾“å…¥ç‰¹å¾ç”¨äºæœºå™¨å­¦ä¹ ã€‚

------

### â‘¢ **æ„å»ºè¡Œä¸ºå›¾åå¯ä»¥è¿›ä¸€æ­¥ç”¨äºï¼š**

| åŠŸèƒ½           | è¯´æ˜                                                         |
| -------------- | ------------------------------------------------------------ |
| å¼‚å¸¸ä¼ æ’­åˆ†æ   | è¡Œä¸ºå›¾ä¸­çš„è¾¹è¡¨ç¤ºè°ƒç”¨ä¾èµ–ï¼Œå¯ä»¥åˆ†æå¼‚å¸¸æ˜¯å¦‚ä½•â€œä¼ æŸ“â€çš„         |
| å¤šæ—¶é—´æ®µå¯¹æ¯”   | å¤šè½®è¿è¡Œåå¯¹æ¯” profile å‘é‡å˜åŒ–è¶‹åŠ¿ï¼Œå‘ç°æœåŠ¡åŠ£åŒ–è¶‹åŠ¿        |
| å¯è§†åŒ–å±•ç¤º     | å°†å›¾å¯¼å‡ºä¸º `.dot` æˆ–ä½¿ç”¨ `networkx`+`matplotlib` å¯è§†åŒ–æœåŠ¡é—´ä¾èµ– |
| æ¨¡æ‹Ÿæˆ–å›å½’æµ‹è¯• | åœ¨æ¨¡æ‹Ÿæ•…éšœæ—¶æ£€æŸ¥ AutoMAP æ˜¯å¦èƒ½å‡†ç¡®é¢„æµ‹æ ¹å›                   |

```
import numpy as np
import networkx as nx
import datetime
from prometheus_api_client import PrometheusConnect
from scipy.stats import chi2_contingency
from sklearn.metrics.pairwise import cosine_similarity
import warnings

warnings.filterwarnings("ignore")

PROMETHEUS_URL = "http://localhost:9090"
prom = PrometheusConnect(url=PROMETHEUS_URL, disable_ssl=True)

SERVICES = [
    "front-end", "carts", "orders", "user", "payment", "shipping", "catalogue"
]

METRICS = ["Mlat", "Mthr", "Mcon", "Mcpu", "Mio", "Mmem", "Mavl"]

METRIC_QUERIES = {
    "Mlat": 'rate(istio_request_duration_milliseconds_sum{{destination_service_name="{svc}"}}[1m]) / rate(istio_request_duration_milliseconds_count{{destination_service_name="{svc}"}}[1m])',
    "Mthr": 'rate(istio_requests_total{{destination_service_name="{svc}"}}[1m])',
    "Mcon": 'rate(istio_requests_total{{destination_service_name="{svc}"}}[1m]) / (rate(istio_request_duration_milliseconds_sum{{destination_service_name="{svc}"}}[1m]) / rate(istio_request_duration_milliseconds_count{{destination_service_name="{svc}"}}[1m]))',
    "Mavl": 'sum(rate(istio_requests_total{{destination_service_name="{svc}", response_code=~"2.."}}[1m])) / sum(rate(istio_requests_total{{destination_service_name="{svc}"}}[1m]))',
    "Mcpu": 'rate(container_cpu_usage_seconds_total{{pod=~"{svc}.*"}}[1m])',
    "Mio": 'rate(container_fs_reads_bytes_total{{pod=~"{svc}.*"}}[1m]) + rate(container_fs_writes_bytes_total{{pod=~"{svc}.*"}}[1m])',
    "Mmem": 'container_memory_usage_bytes{{pod=~"{svc}.*"}}'
}

END_TIME = datetime.datetime.utcnow()
START_TIME = END_TIME - datetime.timedelta(minutes=5)
STEP = "15s"

def conditional_independence_test(x, y):
    contingency_table = np.histogram2d(x, y, bins=10)[0]
    if np.any(contingency_table == 0):
        return False
    chi2, p_value, _, _ = chi2_contingency(contingency_table)
    return p_value > 0.05

def fetch_metrics(prom, metric_type, services):
    data = {}
    fixed_length = 20
    for svc in services:
        print(f"è·å–æŒ‡æ ‡: {metric_type} @ {svc}")
        query = METRIC_QUERIES[metric_type].format(svc=svc)
        try:
            result = prom.custom_query_range(
                query=query,
                start_time=START_TIME,
                end_time=END_TIME,
                step=STEP
            )
            svc_data = []
            for ts in result:
                values = [float(val[1]) for val in ts["values"] if val[1] != "NaN"]
                svc_data.extend(values)
            if len(svc_data) < fixed_length:
                svc_data.extend([0] * (fixed_length - len(svc_data)))
            else:
                svc_data = svc_data[:fixed_length]
            data[svc] = np.array(svc_data)
        except Exception as e:
            print(f"[é”™è¯¯] Prometheus æŸ¥è¯¢å¤±è´¥: {e}")
            data[svc] = np.zeros(fixed_length)
    return data

def get_all_metrics(prom):
    metrics_dict = {}
    for metric in METRICS:
        metrics_dict[metric] = fetch_metrics(prom, metric, SERVICES)
    return metrics_dict

def build_behavior_graph(metrics_dict):
    G = nx.Graph()
    for idx, svc in enumerate(SERVICES):
        G.add_node(idx, name=svc)
    for i in range(len(SERVICES)):
        for j in range(i + 1, len(SERVICES)):
            connected = False
            for metric in METRICS:
                data = metrics_dict[metric]
                indep = conditional_independence_test(data[SERVICES[i]], data[SERVICES[j]])
                if not indep:
                    connected = True
                    break
            if connected:
                G.add_edge(i, j)
    return G

def compute_profiles(metrics_dict):
    profiles = {}
    fixed_length = 20
    for idx, svc in enumerate(SERVICES):
        profile = []
        for metric in METRICS:
            vec = metrics_dict[metric].get(svc, np.zeros(fixed_length))
            if len(vec) < fixed_length:
                vec = np.pad(vec, (0, fixed_length - len(vec)), 'constant')
            elif len(vec) > fixed_length:
                vec = vec[:fixed_length]
            profile.extend(vec)
        profiles[idx] = np.array(profile)
    return profiles

def compute_similarity_matrix(profiles):
    mat = np.array(list(profiles.values()))
    sim = cosine_similarity(mat)
    return sim

def random_walk_ranking(G, scores, restart_prob=0.7, max_iter=100):
    nodes = list(G.nodes)
    A = nx.adjacency_matrix(G).astype(float)
    A = A.todense()
    n = len(nodes)
    A = A / A.sum(axis=1, keepdims=True)
    p = np.ones((n, 1)) / n
    r = scores.reshape((n, 1))

    for _ in range(max_iter):
        p = (1 - restart_prob) * A @ p + restart_prob * r

    ranking = {nodes[i]: p[i, 0] for i in range(n)}
    return sorted(ranking.items(), key=lambda x: x[1], reverse=True)

if __name__ == "__main__":
    metrics_dict = get_all_metrics(prom)
    G = build_behavior_graph(metrics_dict)
    print(f"\n è¡Œä¸ºå›¾èŠ‚ç‚¹æ•°: {G.number_of_nodes()}")
    print(f" è¡Œä¸ºå›¾è¾¹æ•°: {G.number_of_edges()}")

    profiles = compute_profiles(metrics_dict)
    frontend_id = SERVICES.index("front-end")
    print(f"\n front-end profile é•¿åº¦: {len(profiles[frontend_id])}")

    sim_matrix = compute_similarity_matrix(profiles)
    anomaly_score = np.array([np.linalg.norm(profiles[i] - profiles[frontend_id]) for i in range(len(SERVICES))])
    anomaly_score = anomaly_score / np.sum(anomaly_score)

    ranking = random_walk_ranking(G, anomaly_score)
    print("\n æ ¹å› æœåŠ¡æ’åï¼š")
    for rank, (svc_idx, score) in enumerate(ranking):
        print(f"{rank + 1}. {SERVICES[svc_idx]}ï¼ˆå¾—åˆ†: {score:.4f}ï¼‰")

```

